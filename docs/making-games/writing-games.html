<!DOCTYPE html>
<!-- this file is auto-generated from docs/making-games/writing-games.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

    * Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution.
    * Neither the name of Gregg Tavares. nor the names of his
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, user-scalable=yes">
    <meta property="og:title" content="Writing Games"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg"/>
    <meta property="og:description" content="Making Games with HappyFunTimes"/>
    <meta property="og:url" content="http://docs.happyfuntimes.net/docs/making-games/writing-games.html"/>

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@greggman"/>
    <meta name="twitter:creator" content="@greggman"/>
    <meta name="twitter:domain" content="docs.happyfuntimes.net"/>
    <meta name="twitter:title" content="Writing Games"/>
    <meta name="twitter:url" content="http://docs.happyfuntimes.net/docs/making-games/writing-games.html"/>
    <meta name="twitter:description" content="Making Games with HappyFunTimes"/>
    <meta name="twitter:image:src" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg"/>

    <title>Writing Games</title>

    <link href="/public/hft-icon.png" rel="shortcut icon" type="image/png">
    <link rel="stylesheet" href="/docs/assets/css/styles.css" type="text/css"/>
</head>
<body>

<div class="header">
  <h1><a href="/docs/making-games">HappyFunTimes Docs</a></h1>
</div>



<div class="container">

    <div class="docs-title">
        <h1>Writing Games</h1>
    </div>

    <div class="row">
        <div class="col-xs-12 col-lg-8 docs-content">

            <p>If you&#39;re doing it in JavaScript use any game framework you want, copy one of the examples,
or write from scratch but a few <em>rules</em>. If you&#39;re doing it in Unity3D or any other language
you should still follow the info below.</p>
<p>The easist way to get started is to clone one of the existing games.</p>
<h3 id="contents">Contents</h3>
<ul>
<li><a href="#available-example-games">Available example games</a></li>
<li><a href="#using-an-example-game">Using an example Game</a></li>
<li><a href="#the-controller">The Controller</a><ul>
<li><a href="#controller-js">controller.js</a></li>
<li><a href="#dealing-with-different-device-sizes">Dealing with different device sizes</a></li>
</ul>
</li>
<li><a href="#the-game">The Game</a><ul>
<li><a href="#game-js">game.js</a></li>
<li><a href="#game-html">game.html</a></li>
</ul>
</li>
<li><a href="#player-handling">Player Handling</a><ul>
<li><a href="#handling-player-names">Handling Player Names</a></li>
</ul>
</li>
<li><a href="#communication-between-game-and-controllers">Communication between Game and Controllers</a><ul>
<li><a href="#send-commands-from-the-game-to-controllers">From Game to Controllers</a></li>
<li><a href="#send-commands-from-the-controller-to-the-game">From Controllers to the Game</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="available-example-games">Available example Games</h2>
<ul>
<li><p><a href="http://github.com/greggman/hft-jumpjump">JumpJump</a><br>A simple platform game written in JavaScript using WebGL / TDL</p>
</li>
<li><p><a href="http://github.com/greggman/hft-boomboom">BoomBoom</a><br>A bomb placing game written in JavaScript using WebGL / TDL</p>
</li>
<li><p><a href="http://github.com/greggman/hft-powpow">PowPow</a><br>A space wars game written in JavaScript using WebGL / TDL</p>
</li>
<li><p><a href="http://github.com/greggman/hft-simple">Simple</a><br>The simplest example. Just moves dots around.</p>
</li>
<li><p><a href="http://github.com/greggman/hft-deviceorientation">Deviceorientation</a><br>A device orientation sample written in JavaScript using WebGL / Three.js</p>
</li>
<li><p><a href="http://github.com/greggman/hft-unitycharacterexample">Unitychararacterexample</a><br>A Unity3D example that spawns characters written in UnityScript.</p>
</li>
<li><p><a href="http://github.com/greggman/hft-simple">Unitysimple</a><br>A Unity3D example that just positions a sphere for each player written in C#.</p>
</li>
</ul>
<h2 id="using-an-example-game">Using an example Game</h2>
<p>For example to clone JumpJump you&#39;d type</p>
<pre><code>git clone https://github.com/greggman/hft-jumpjump.git
</code></pre><p>This should clone game into the folder <code>hft-jumpjump</code>.</p>
<p>Or alternatively click one of the links above and click &quot;Download ZIP&quot; on the right side of the page and
then unzip it.</p>
<p>After cloning you must edit <code>package.json</code>. At a minimum change the <code>gameId</code> to something original like</p>
<pre><code>&quot;gameId&quot;: &quot;MyAwesomePartyGame&quot;,
</code></pre><p>Choose something original unlikely to clash with other games since ids must be unique.
The id may only use A-Z 0-9 _ and -. No spaces. No other punctuation or non alpha numerica characters.</p>
<p>You&#39;ll probably also want to edit the <code>name</code> and <code>description</code>.</p>
<p>Finally cd to the folder you cloned to and add the game. In our example</p>
<pre><code>cd hft-jumpjump
hft add
</code></pre><p>It should say game added. Now run HappyFunTimes. You should see your game added.</p>
<hr>
<h2 id="the-controller">The Controller</h2>
<p>Controllers are the component that runs on the mobile devices. This part must be
written in HTML/JavaScript as that&#39;s kind of the point. It needs to run on the
device without requiring the user to install anything.</p>
<p><code>contoller.html</code> is inserted into a template at runtime. The template provides
common UI features like the settings icon in the top right corner, a name input
and support for switching games.</p>
<p>The CommonUI currently consists of the gear menu top right of the display as well
has handling of name editing, disconnecting, and auto switching to the new games.</p>
<h3 id="controller-js">controller.js</h3>
<p>The minimum contents of a <code>controller.js</code> is</p>
<pre><code>&quot;use strict&quot;;

// Start the main app logic.
requirejs(
    [
        &#39;hft/gameclient&#39;,
        &#39;hft/commonui&#39;,
        &#39;hft/misc/misc&#39;,
        &#39;hft/misc/mobilehacks&#39;
    ], function (GameClient, CommonUI, Misc, MobileHacks) {

        var g_client;

        var globals = {
            debug: false,
        };

        Misc.applyUrlSettings(globals);
        MobileHacks.fixHeightHack();

        g_client = new GameClient();

        CommonUI.setupStandardControllerUI(g_client, globals);

        // Insert your controller specific code here.
    });
</code></pre><h3 id="dealing-with-different-device-sizes">Dealing with different device sizes</h3>
<p>The hardest part of creating a controller is handling CSS and placement across browser
versions and devices. There are thousands of different mobile devices from mobile
phones to tablets that all have different screens sizes and software running, resulting
in thousand of different viewport sizes. The viewport is the actual space of a browser
that is available for the controller: screen size minus notification bar minus the browsers
URL bar and other elements.</p>
<h4 id="possible-solution-for-newer-devices">Possible solution for newer devices</h4>
<p>If you want to support newer devices with browsers that are actually up to date, you may
use CSS viewport units. Viewport units use the actual size of the devices&#39; viewport to calculate
the width or height or an element. 
This means that if you use viewport units like <code>10vh</code> instead of fixed values like <code>60px</code>, the
elements height will be equally larger on all devices instead of very large on 4&quot; phones and pretty
small on 10&quot; tablets.</p>
<p><strong>Example</strong><br>A controller element gets the following CSS styling:</p>
<pre><code>.box {
    width: 50vh;
    height: 50vh;
}
</code></pre><p>The elements height and with will equal 50% of the available viewport size.</p>
<p><code>50vh</code> equals <code>50%</code> of the browser size. <code>10vh</code> would equal <code>10%</code>.</p>
<p>If you want to know which browsers support viewport units, see <a href="http://caniuse.com/#feat=viewport-units">this overview</a>.
Make sure to set the units for each portrait and landscape mode.</p>
<hr>
<h2 id="the-game">The Game</h2>
<p>The game component is what is displayed on the big screen and that is visible to all players
at the same time. The <code>game.js</code> file must contain some code to initialize the game and run
the corresponding HFT server for controllers to connect.</p>
<h3 id="game-js">game.js</h3>
<p>The minimum content of the <code>game.js</code> file is</p>
<pre><code>&quot;use strict&quot;;

requirejs(
    [
        &#39;hft/scripts/gameserver&#39;,
        &#39;hft/scripts/gamesupport&#39;,
        &#39;hft/scripts/misc/misc&#39;
    ], function (GameServer, GameSupport, Misc) {

        // You can set these from the URL with
        // http://localhost:18679/games/&lt;gameid&gt;/gameview.html?settings={name:value,name:value}
        var globals = {
            haveServer: true,
            debug: false,
        };

        Misc.applyUrlSettings(globals);

        var server;
        if (globals.haveServer) {
            server = new GameServer();
            server.addEventListener(&#39;playerconnect&#39;, someFunctionThatCreatesAPlayer);
        }

        GameSupport.init(server, globals);

        // Your init code goes here.

        var mainloop = function () {

            // your game&#39;s main loop code goes here.
        };

        GameSupport.run(globals, mainloop);
    });
</code></pre><p>GameSupport will set <code>globals.elapsedTime</code> to the time in seconds that have elapsed
since the last call to your mainloop. <code>globals.gameTime</code> is the time since the game
started.<br><code>global.frameCount</code> is the number of times your main loop has been called.</p>
<h3 id="game-html">game.html</h3>
<p>game.html is loaded into a template at runtime. The template provides the following features</p>
<ul>
<li>Handles displaying a disconnected message if the game gets disconnected from the
HFT server.</li>
<li>Will display an FPS meter if <code>showFPS</code> is set to <code>true</code>.</li>
<li>Provides a requestAnimationFrame based mainloop callback.</li>
<li>Provides an <code>elapsedTime</code> and <code>frameCount</code>.<br>The elapsed time is in seconds since the last frame and is limited to being no longer
than 1/20th of a second. Otherwise if you pause the game for a few seconds you&#39;d get
a giant elapsedTime and your game would probably break.</li>
<li><p>Will add a few HTML overlays for debugging if <code>debug</code> is set to <code>true</code></p>
<ul>
<li><p>You can display per frame info with</p>
<pre><code>GameSupport.setStatus(msg);
</code></pre><p>For example:</p>
<pre><code>var globals = {
    debug: true,
}

GameSupport.init(server, globals);

var mainloop = function() {
   var msgs = [];
   msgs.push(&quot;elapsedTime: &quot; + globals.elapsedtIme);
   msgs.push(&quot;frames: + globals.frameCount);
   GameSupport.setStatus(msgs.join(&quot;\n&quot;));
};
</code></pre></li>
<li><p>You can display to an onscreen console with</p>
<pre><code>GameSupport.log(&quot;hello&quot;);
GameSupport.error(&quot;oops&quot;);
</code></pre><p>These are not that useful given debugging tools in the browser but they can be
useful on devices for which there is no easily accessable console. Note that
you can get a remote debug from both <a href="https://developer.apple.com/library/safari/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Safari_Developer_Guide.pdf">iOS devices and the iOS simulator</a>
and similarly in <a href="https://developer.chrome.com/devtools/docs/remote-debugging">Chrome on Android</a>.</p>
</li>
</ul>
</li>
<li><p>Will optionally pause when the game does not have the focus.</p>
<p>Games running at 60fps eat up battery like crazy. Normally on modern OSes with fancy
compositied desktops, bringing your editor to the front is not enough to tell an app
to stop rendering.
Therefore HFT games will stop rendering if they are not in the focus of the user.</p>
<p>If you have the Chome developer tools open and they have the focus, the game will stop.
That can be confusing. Simiarly, if you are debugging controllers by opening other
browser windows / tabs the game will stop when you try to use the controller.</p>
<p>You can make the game playable without controllers by passing <code>haveServer: false</code>. If
you see that the init code will spawn 2 players with <code>LocalNetPlayer</code> for their
<code>NetPlayer</code>. You may then setup some keyboard or mouse input to generate events on
the <code>LocalNetPlayer</code> which the player code will see as inputs from a controller.</p>
<p>This means you can play the game by going to the game&#39;s URL like</p>
<pre><code>http://localhost:18679/games/jumpjump/game.html?settings={haveServer:false}
</code></pre><p>When you want to test with real controllers you remove the <code>haveServer:false</code>. That
way the game continues to run even when a controller window has the focus.</p>
</li>
</ul>
<hr>
<h3 id="handling-players">Handling Players</h3>
<p>Remember the line <code>server.addEventListener(&#39;playerconnect&#39;, someFunctionThatCreatesAPlayer);</code>
from the <code>game.js</code> file? That function is used to register players. It get&#39;s passed a
<code>NetPlayer</code> object which represents the connction between your game and a player&#39;s device.</p>
<p>Simple handling of players might look like this:</p>
<pre><code>var players = [];  // Array of all players

// Make a &quot;class&quot; Player.
function Player(netPlayer, name) {
  this.netPlayer = netPlayer;
  this.name = name;

  // At a minimum, handle the disconnect
  netPlayer.addEventListener(&#39;disconnect&#39;, Player.prototype.handleDisconnect.bind(this));
}

Player.prototype.handleDisconnect = function() {
  var index = players.indexOf(this);
  if (index &gt;= 0) {
    players.splice(index, 1);  // removes this player from the list of players
  }
};

function someFunctionThatCreatesAPlayeer(netPlayer, name) {
   // Create a new player and add it to our array of players.
   players.push(new Player(netPlayer, name));
}
</code></pre><p>As you can see we created a Player class that is used to store all data and functions
for a connected player. You may also move this class to a separate file and add it
to the <code>requirejs</code> function. This is a good practise to keep your game files small and 
clear.</p>
<h3 id="handling-player-names">Handling Player Names</h3>
<p>The CommonUI allows the player to choose a name. That name is sent when the player connects
but the player can set their name anytime by choosing the wrench menu and selecting &quot;Set Name&quot;.</p>
<p>Two messages are sent from the controller to the game: <code>busy</code> and <code>setName</code>.</p>
<p><code>busy</code> indicates the player is on system menu which means they are not playing at the moment.
It will be passed an object with <code>busy:true</code> or <code>busy:false</code> when they enter and exit the system
menus.</p>
<p>It&#39;s up to you to decide if you care. For example maybe you&#39;d like to remove them from the game when you
receive the message something like</p>
<pre><code>netPlayer.addEventListener(&#39;busy&#39;, Player.prototype.handleBusyMsg.bind(this));

Player.prototype.handleBusyMsg = function(data) {
   if (data.busy) {
      // The player is using the system menu right now
      player.hidden = true;
      player.collisionsOff = true;
   } else {
      player.hidden = false;
      player.collisionsOn = true;
   }
};
</code></pre><p><code>setName</code> indicates the player has chosen a new name. If the name is blank you can send a name
back to the controller.</p>
<pre><code>netPlayer.addEventListenter(&#39;setName&#39;, Player.prototype.handleSetNameMsg.bind(this));

Player.prototype.handleSetNameMsg = function(data) {
  player.name = data.name || &quot;The Unknown Solider&quot;;

  // If we set the name, send it back to the phone
  if (!data.name) {
    this.netPlayer.sendCmd(&#39;setName&#39;, {name: player.name});
  }
};
</code></pre><hr>
<h2 id="communication-between-game-and-controllers">Communication between Game and Controllers</h2>
<p>To exchange data or send events from the game to the controllers or input from the
controller back to the game, use simple JavaScript events. Both the game and controllers
use event listeners to react to emitted events.</p>
<h3 id="send-commands-from-the-game-to-controllers">Send Commands from the Game to Controllers</h3>
<p>The game can send commands to individual players only. To send a command like a broadcast 
to all players, you have to loop trough all players and send the command to each player
individually.</p>
<p>In <code>game.js</code> you can send a command by using the following code:</p>
<pre><code>somePlayer.netPlayer.sendCmd(&#39;someCommand&#39;, { someColor: &quot;red&quot;});
</code></pre><p>Then in <code>controller.js</code> you have to create an event listener that listens to the command:</p>
<pre><code>g_client.addEventListener(&#39;someCommand&#39;, handleSomeCommand);

function handleSomeCommand(data) {
    document.body.style.backgroundColor = data.someColor;
}
</code></pre><p><code>data</code> will contain whatever is sent from <code>sendCmd</code>, in this example an object with the
property <code>someColor</code>.
A command may also be empty to toggle global events like the start of a new round.</p>
<h3 id="send-commands-from-the-controller-to-the-game">Send Commands from the Controller to the Game</h3>
<p>Each time the player interacts with his controller, the controller may send the input to
the game. This can be touch operations, the use of a gamepad, button clicks or text
input.</p>
<p>In <code>controller.js</code> you can send a command by using the following code:</p>
<pre><code>g_client.sendCmd(&#39;someCommand&#39;, { someNumber: 123, someString, &quot;abc&quot;, someBool: true});
</code></pre><p>Then in <code>controller.js</code> you have to create an event listener that listens to the command:</p>
<pre><code>g_server.addEventListener(&#39;someCommand&#39;, handleSomeCommand);

function handleSomeCommand(data) {
    console.log(JSON.stringify(data));
};
</code></pre><p>This example would print the following to the browser console of the game:</p>
<pre><code>{&quot;someNumber&quot;:123,&quot;someString&quot;:&quot;abc&quot;,&quot;someBool&quot;:true}
</code></pre>

            <div class="docs-footer">

                <div>Found a bug? <a href="http://github.com/greggman/happyfuntimes/issues">Create an issue on Github</a></div>

                <div class="docs-comments">
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        var disqus_shortname = 'happyfuntimes';
                        var disqus_identifier = 'Writing Games';
                        var disqus_title = 'Writing Games';

                        /* * * DON'T EDIT BELOW THIS LINE * * */
                        (function () {
                            if (window.location.hostname.indexOf("happyfuntimes") < 0) {
                                return;
                            }
                            var dsq = document.createElement('script');
                            dsq.type = 'text/javascript';
                            dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments
                        powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">
                        comments powered by <span class="logo-disqus">Disqus</span>
                    </a>
                </div>

            </div>
        </div>

        <div class="col-xs-12 col-lg-4 docs-sidebar">
            <ul class="nav">
    <li><a href="../introduction.html">Introduction</a></li>
    <li>
        <b>Setup</b>
        <ul class="nav">
            <li><a href="../setup/macos.html">OSX</a></li>
            <li><a href="../setup/windows.html">Windows</a></li>
            <li><a href="../setup/linux.html">Linux</a></li>
        </ul>
    </li>
    <li>
        <b>Making Games</b>
        <ul class="nav">
            <li><a href="index.html">Making games in HTML5</a></li>
            <li><a href="../unity">Making games in Unity3D</a></li>
            <li><a href="../tips.html">Tips</a></li>
            <li><a href="../commands.html">hft command</a></li>
        </ul>
    </li>
    <li>
        <b>Ideas and Examples</b>
        <ul class="nav">
            <li><a href="../ideas.html">Ideas</a></li>
            <li><a href="../examples.html">Examples</a></li>
        </ul>
    </li>
    <li>
        <b>API</b>
        <ul class="nav">
            <li><a href="../api-versions.html">API Versions</a></li>
            <li><a href="../migration.html">Migrating from older APIs</a></li>
        </ul>
    </li>
    <li>
        <b>Other Content</b>
        <ul class="nav">
            <li><a href="../network.html">Museums & Installations</a></li>
        </ul>
    </li>
    <li>
        <b>Contributing</b>
        <ul class="nav">
            <li><a href="../contributing.html">Contributing</a></li>
            <li><a href="../future.html">Future Features</a></li>
        </ul>
    </li>
</ul>

        </div>

    </div>
</div>

<script src="/docs/assets/3rdparty/jquery.js"></script>
<script src="/docs/assets/3rdparty/highlight.js"></script>
<script src="/docs/assets/js/lesson.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51764205-4', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>



