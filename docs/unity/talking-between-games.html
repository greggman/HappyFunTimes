<!DOCTYPE html>
<!-- this file is auto-generated from docs/unity/talking-between-games.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

    * Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution.
    * Neither the name of Gregg Tavares. nor the names of his
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, user-scalable=yes">
    <meta property="og:title" content="Communicating Between Games"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg"/>
    <meta property="og:description" content="How to send messages between games"/>
    <meta property="og:url" content="http://docs.happyfuntimes.net/docs/unity/talking-between-games.html"/>

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@greggman"/>
    <meta name="twitter:creator" content="@greggman"/>
    <meta name="twitter:domain" content="docs.happyfuntimes.net"/>
    <meta name="twitter:title" content="Communicating Between Games"/>
    <meta name="twitter:url" content="http://docs.happyfuntimes.net/docs/unity/talking-between-games.html"/>
    <meta name="twitter:description" content="How to send messages between games"/>
    <meta name="twitter:image:src" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg"/>

    <title>Communicating Between Games</title>

    <link href="/public/hft-icon.png" rel="shortcut icon" type="image/png">
    <link rel="stylesheet" href="/docs/assets/css/styles.css" type="text/css"/>
</head>
<body>

<div class="header">
  <h1><a href="/docs/unity">HappyFunTimes Docs</a></h1>
</div>



<div class="container">

    <div class="docs-title">
        <h1>Communicating Between Games</h1>
    </div>

    <div class="row">
        <div class="col-xs-12 col-lg-8 docs-content">

            <p>First off if you haven&#39;t already you should read about <a href="multi-machine.html">multi-machine games</a>.
Those are games that run across multiple computers.</p>
<p>Sometimes through you aren&#39;t running game. You just want to syncronize data
between computers.</p>
<p>For example this runs on 8 computers. The only thing sychronized are some of the settings
and the clock.</p>
<iframe width="853" height="480" src="https://www.youtube.com/embed/64TcBiqmVko?rel=0" frameborder="0" allowfullscreen></iframe>

<p>To see a simple example open the <code>Assets/HappyFunTimes/MoreSamples/multi-machine-syncedclock/Scenes/MultiMachineSyncedClock</code></p>
<p>You can run this sample solo in the Unity Editor but to run multiple copies it
<strong>MUST BE RUN FROM THE COMMAND LINE</strong>. The reason is each needs be told which
portion of the larger display to render.</p>
<p>Pick <code>File-&gt;Build Settings...</code> from the menus</p>
<p><img src="images/multi-machine-build-settings-menu.png" class="halfsize lesson" /></p>
<p>Make sure the MultiMachineSyncedClock scene is the only scene selected.
If it doesn&#39;t appear click the <code>Add Open Scenes</code> button to add it.</p>
<p><img src="images/multi-machine-synced-clock-build-settings.png" class="halfsize lesson" /></p>
<p>Now click <code>Build</code> at the bottom. Save it as <code>test.app</code> if you&#39;re on OSX or <code>test.exe</code> if you&#39;re
on Windows.</p>
<p>Then on OSX open the Terminal, cd to the older you exported the game to, then type or copy
and paste each of these lines. You will need to get Unity to run the game in a window.</p>
<p><strong>Note: It&#39;s important to put the <code>&amp;</code> at the end of each line</strong></p>
<pre><code>test.app/Contents/MacOS/test --mm-full-width=1680 --mm-full-height=1050 --mm-x=0 --mm-y=0 --mm-width=400 --mm-height=300 &amp;
test.app/Contents/MacOS/test --mm-full-width=1680 --mm-full-height=1050 --mm-x=400 --mm-y=0 --mm-width=400 --mm-height=300 --hft-url=ws://localhost:18679 &amp;
test.app/Contents/MacOS/test --mm-full-width=1680 --mm-full-height=1050 --mm-x=800 --mm-y=0 --mm-width=400 --mm-height=300 --hft-url=ws://localhost:18679 &amp;
</code></pre><p>If you&#39;re on Windows open a command prompt and type these commands</p>
<pre><code>start /B test.exe --mm-full-width=1680 --mm-full-height=1050 --mm-x=0 --mm-y=0 --mm-width=400 --mm-height=300 &amp;
start /B test.exe --mm-full-width=1680 --mm-full-height=1050 --mm-x=400 --mm-y=0 --mm-width=400 --mm-height=300 --hft-url=ws://localhost:18679 &amp;
start /B test.exe --mm-full-width=1680 --mm-full-height=1050 --mm-x=800 --mm-y=0 --mm-width=400 --mm-height=300 --hft-url=ws://localhost:18679 &amp;
</code></pre><p>If you arrange the windows left to right in the order you started them you should
see them all synchronized like this.</p>
<p><img src="images/multi-machine-synced-clock.gif" class="lesson" /></p>
<p>You can set the field of view on any one of them and it will set them on all.</p>
<p>If you actually have 3 separate machines to run on and they are all on the same network
run the game once on each machine except look up the IP address of the first machine
and change <code>localhost</code> to that ipaddress. For example my ip address is <code>192.168.2.9</code> so
I&#39;d use <code>--hft-url=ws://192.168.2.9:18679</code></p>
<h2 id="sending-messages-between-games">Sending Messages between Games</h2>
<p>Sending and receiving messages from other games is very similar to sending and receiving messages
to and from phones except instead of using <code>NetPlayer</code> you use <code>GameServer</code>.</p>
<p>You can access the <code>GameServer</code> for your game through the <code>PlayerSpawner.GameServer</code>,
 <code>PlayerConnector.GameServer</code>, or <code>HFTNoPlayers.GameServer</code> property.</p>
<p>If you open <code>Assets/HappyFunTimes/MoreSamples/multi-machine-syncedclock/Scripts/ExampleSetCameraAcrossMachines.cs</code>
you can see we get the <code>HFTNoPlayers</code> component and from that the <code>GameServer</code></p>
<pre><code>void Start()
{
    HFTNoPlayers noPlayers = GetComponent&lt;HFTNoPlayers&gt;();
    m_gameServer = noPlayers.GameServer;
}

GameServer m_gameServer;
</code></pre><p>To send a message to a game you call <code>GameServer.SendCmdToGame(gameId, cmd, data)</code>
where <code>gameId</code> is the id of the game you want to send the message to. <code>cmd</code> is
a string specifying a command you make up and <code>data</code> is the any data you want to
send just like you do with when talking to controllers.</p>
<pre><code>class FovMsg {
    public FovMsg() {}  // for deserailization
    public FovMsg(float fov)
    {
        this.fov = fov;
    }
    public float fov;
}

// send an FOV message to game &quot;gameABC&quot;
m_gameServer.SendCmdToGame(&quot;gameABC&quot;, &quot;fov&quot;, new FovMsg(12));
</code></pre><p>To receive the messages you add handlers to the <code>GameServer</code></p>
<pre><code>void Start() {
    HFTNoPlayers noPlayers = GetComponent&lt;HFTNoPlayers&gt;();
    m_gameServer = noPlayers.GameServer;

    m_gameServer.RegisterCmdHandler&lt;FovMsg&gt;(&quot;fov&quot;, HandleFovChange);
}

void HandleFovChange(FovMsg data, string otherGameId)
{
    Debug.Log(otherGameId + &quot; send us an fov of &quot; + data.fov);
}
</code></pre><p>You can also broadcast to all games by calling <code>GameServer.BroadcastCmdToGames</code>.</p>
<pre><code>m_gameServer.BroadcastCmdToGames(&quot;fov&quot;, new FovMsg(m_options.fieldOfView));
</code></pre><p>Even your own game will receive the message.</p>
<p>In our example we have code like this to put up the fov slider</p>
<pre><code>void OnGUI()
{
    float oldFieldOfView = m_options.fieldOfView;
    GUILayout.BeginArea (new Rect (15, 15, 200, 60));
    GUILayout.BeginVertical();
    GUILayout.Box(&quot;fov: &quot; + Mathf.Round(m_options.fieldOfView));
    m_options.fieldOfView = GUILayout.HorizontalSlider (m_options.fieldOfView, 10.0f, 170.0f);
    GUILayout.EndVertical();
    GUILayout.EndArea();

    // Only send if it changed
    if (oldFieldOfView != m_options.fieldOfView)
    {
        // broadcast the new fov to all games
        m_gameServer.BroadcastCmdToGames(&quot;fov&quot;, new FovMsg(m_options.fieldOfView));
    }
}
</code></pre><p>NOTICE we don&#39;t set the camera&#39;s fov here. We just broadcast the message.
We&#39;ll get that message back ourselves.</p>
<p>Our <code>&quot;fov&#39;</code> message handler looks like this</p>
<pre><code>void HandleFovChange(FovMsg data, string otherGameId)
{
    // If we&#39;re currently dragging the slider
    // we don&#39;t want to muck with it&#39;s value
    if (otherGameId != m_gameServer.Id)
    {
        m_options.fieldOfView = data.fov;
    }

    UpdateCamera();
}
</code></pre><p>Because of the way Unity&#39;s IMGUI works we don&#39;t want to set <code>m_options.fieldOfView</code>
if we&#39;re the ones the sent the message. We do want to update the camera though
with the settings.</p>
<p>Look though the rest of the code and you&#39;ll find stuff about parsing arguments
so that each game knows which part of a large virtual display to render.</p>
<h2 id="synced-clocks">Synced Clocks</h2>
<p>The way this example works is that there are a grid of cubes all rotating
around a parent. That parent&#39;s rotation is set directly from a clock that
happyfuntimes keeps synchronized across machines.</p>
<p>Look in <code>Assets/HappyFunTimes/MoreSamples/multi-machine-syncedclock/Scripts/ExampleRotateBySyncClock.cs</code></p>
<pre><code>public float speed = 1.0f;

void Update ()
{
    double time = HFTSyncedClock.Now;
    float rotation = (float)(time * (double)speed % 360.0);
    transform.eulerAngles = new Vector3(0.0f, rotation, 0.0f);
}
</code></pre><p>And you&#39;ll see it&#39;s pretty straight forward. All we do is set the rotation to the clock.
Because the clock is synchronized every game will display the cubes rotated at the same places
at the same time.</p>
<p>We could use the clock to move characters on paths or do more complicated calculation but as
long as they are based on <code>HFTSyncedClock.Now</code> they&#39;ll match across machines.</p>
<p>The synchronized clock is also available for phones. See the example in
<code>Assets/HappyFunTimes/MoreSamples/synchedclock/Scenes/SyncedClockScene</code></p>


            <div class="docs-footer">

                <div>Found a bug? <a href="http://github.com/greggman/happyfuntimes/issues">Create an issue on Github</a></div>

                <div class="docs-comments">
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        var disqus_shortname = 'happyfuntimes';
                        var disqus_identifier = 'Communicating Between Games';
                        var disqus_title = 'Communicating Between Games';

                        /* * * DON'T EDIT BELOW THIS LINE * * */
                        (function () {
                            if (window.location.hostname.indexOf("happyfuntimes") < 0) {
                                return;
                            }
                            var dsq = document.createElement('script');
                            dsq.type = 'text/javascript';
                            dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments
                        powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">
                        comments powered by <span class="logo-disqus">Disqus</span>
                    </a>
                </div>

            </div>
        </div>

        <div class="col-xs-12 col-lg-4 docs-sidebar">
            <ul class="toc">
    <li>HappyFunTimes & Unity
        <ul>
            <li><a href="getting-started.html">Getting Started</a><span class="hide">: Do this first!</span></li>
            <li><a href="first-game.html">Your First HappyFunTimes Game</a><span class="hide">: Do this second!</span>
            </li>
            <li><a href="gamepad.html">The Sample Gamepad</a><span class="hide">: Read this!</span></li>
            <li><a href="basics.html">How it Works</a><span class="hide">: Read this!</span></li>
        </ul>
    </li>
    <li>Specifics
        <ul>
            <li><a href="player-connect.html">Spawn players</a></li>
            <li><a href="self-control.html">Making controllers (the phone part)</a></li>
            <li><a href="gamepad-sounds.html">Playing sounds on the phone</a></li>
            <li><a href="gamepad-multitouch.html">Handling Multi-Touch</a></li>
        </ul>
    </li>
    <li>Examples
        <ul>
            <li><a href="3d-characters.html">3d Characters</a></li>
            <li><a href="2d-platformer.html">2d Platformer</a></li>
        </ul>
    </li>
    <li>Techinques
        <ul>
            <li><a href="reusing-players.html">Handling disconnect and reconnect</a></li>
            <li><a href="too-many-players.html">Preventing too many players</a></li>
            <li><a href="device-orientation.html">Using Device Orientation</a></li>
            <li><a href="accelerometer.html">Using the Accelerometer</a></li>
            <li><a href="character-selection.html">Spawning different characters per Player</a></li>
            <li><a href="multi-machine.html">Multiple Computers</a></li>
            <li><a href="talking-between-games.html">Talking Between Multiple Computers</a></li>
        </ul>
    </li>
    <li>Sample-UI API Reference
        <ul>
            <li><a href="/docs/hft/">Sample UI (HTML/JavaScript) API</a></li>
        </ul>
    </li>
    <li>Other
        <ul>
            <li><a href="changelog.html">Changelog</a></li>
        </ul>
    </li>
</ul>




        </div>

    </div>
</div>

<script src="/docs/assets/3rdparty/jquery.js"></script>
<script src="/docs/assets/3rdparty/highlight.js"></script>
<script src="/docs/assets/js/lesson.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51764205-4', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>



