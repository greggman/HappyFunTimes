<!DOCTYPE html>
<!-- this file is auto-generated from docs/unity/basics.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

    * Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution.
    * Neither the name of Gregg Tavares. nor the names of his
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, user-scalable=yes">
    <meta property="og:title" content="The Basics of HappyFunTimes and Unity"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg"/>
    <meta property="og:description" content="Read This so you know what to expect"/>
    <meta property="og:url" content="http://docs.happyfuntimes.net/docs/unity/basics.html"/>

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@greggman"/>
    <meta name="twitter:creator" content="@greggman"/>
    <meta name="twitter:domain" content="docs.happyfuntimes.net"/>
    <meta name="twitter:title" content="The Basics of HappyFunTimes and Unity"/>
    <meta name="twitter:url" content="http://docs.happyfuntimes.net/docs/unity/basics.html"/>
    <meta name="twitter:description" content="Read This so you know what to expect"/>
    <meta name="twitter:image:src" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg"/>

    <title>The Basics of HappyFunTimes and Unity</title>

    <link href="/public/hft-icon.png" rel="shortcut icon" type="image/png">
    <link rel="stylesheet" href="/docs/assets/css/styles.css" type="text/css"/>
</head>
<body>

<div class="header">
  <h1><a href="/docs/unity">HappyFunTimes Docs</a></h1>
</div>



<div class="container">

    <div class="docs-title">
        <h1>The Basics of HappyFunTimes and Unity</h1>
    </div>

    <div class="row">
        <div class="col-xs-12 col-lg-8 docs-content">

            <p>HappyFunTimes library that lets you
make games that use smartphones as controllers. The games
can be created in HTML5 or Unity3D (more coming).</p>
<p>HappyFunTimes only provides the communications. It does
<strong>not</strong> provide controller implementations (the part that
runs on the phone) though there are many samples you can
start from. In fact <a href="gamepad.html">if you want to get started quick
as possible see the included gamepads</a>.
Otherwise the following covers the basics of how to
make everything custom.</p>
<p>HappyFunTimes also does not supply a game engine. That&#39;s
what Unity3D is for.</p>
<h2 id="open-the-simple-example">Open the simple example</h2>
<p>The closest example to the code below is contained in the simple scene
in <code>Assets/HappyFunTimes/MoreSamples/Simple/Scenes/HappyFunTimesSimpleExample</code>
Inside you&#39;ll find <code>ExampleSimpleSpawner</code> that contains the <code>PlayerSpawner</code>
mentioned below. Similarly you&#39;ll find it spawns a prefab called <code>PrefabForExampleSimple</code>
that contains a script <code>ExampleSimplePlayer</code> that is very similar to the code
below.</p>
<p>For the JavaScript parts look inside
<code>Assets/WebPlayerTemplates/HappyFunTimes/controllers/simple/scripts/controller.js</code></p>
<h2 id="how-it-works">How it works</h2>
<p>When a player connects the HappyFunTimes script <code>PlayerSpawner</code>
spawns prefab in your game and calls the
<code>InitializeNetPlayer</code> method in any scripts attached
to that prefab. <code>InitializeNetPlayer</code> is passed a
<code>NetPlayer</code> object. That object can be used to send
and receive messages from the phone.</p>
<h2 id="receiving-data-from-the-phone">Receiving data from the Phone</h2>
<p>When your <code>InitializeNetPlayer</code> method is called you can
register command handlers by calling <code>NetPlayer.RegisterCmdHandler</code>
and passing the name of the command and the function to call
when the command arrives from the phone. For example:</p>
<pre><code>private HappyFunTimes.NetPlayer m_netPlayer;

void InitializeNetPlayer(SpawnInfo spawnInfo) {
    // Save the netplayer object so we can use it send messages to the phone
    m_netPlayer = spawnInfo.netPlayer;

    // Register handler to call if the player disconnects from the game.
    m_netPlayer.OnDisconnect += Remove;

    // Setup events for the different messages.
    m_netPlayer.RegisterCmdHandler&lt;MessageColor&gt;(&quot;color&quot;, OnColor);
    m_netPlayer.RegisterCmdHandler&lt;MessageMove&gt;(&quot;move&quot;, OnMove);
}
</code></pre><p>Here you can see a typical <code>InitializeNetPlayer</code> method in C#. This line</p>
<pre><code>m_netPlayer.RegisterCmdHandler&lt;MessageMove&gt;(&quot;move&quot;, OnMove);
</code></pre><p>says when the command &quot;move&quot; comes in, convert the data in that message to
a <code>MessageMove</code> class and then call the method <code>OnMove</code>.</p>
<p>The <code>MessageMove</code> class makes all its fields public</p>
<pre><code>private class MessageMove {
    public float x = 0;
    public float y = 0;
};
</code></pre><p>The <code>OnMove</code> method looks like this</p>
<pre><code>private void OnMove(MessageMove data) {
    m_position.x = data.x;
    m_position.z = data.y;

    gameObject.transform.localPosition = m_position;
}
</code></pre><p>The <code>JavaScript</code> running on the phone looks like this</p>
<pre><code>client.sendCmd(&#39;move&#39;, {
  x: position.x,
  y: position.y,
});
</code></pre><p>Whenever the phone executes that snippet of JavaScript the <code>OnMove</code>
method we registered with <code>RegisterCmdHandler</code> will get called.</p>
<p><strong>Note: It&#39;s up to you to make up commands appropriate for your game.
It&#39;s also up to you to decide what data to pass from the phone to the
game and create the approriate class and function to receive the data.</strong></p>
<p>Of course you can always start with one of the samples</p>
<h2 id="sending-data-to-the-phone">Sending data to the phone</h2>
<p>Sending data to the phone is just the reverse. First we make
class to represent the data we want to send.</p>
<pre><code>private class MessageScored {
    public MessageScored(int _points) {
        points = _points;
    }

    public int points;
}
</code></pre><p>Then we send it through the <code>NetPlayer</code> object we saved in <code>InitializeNetPlayer</code>.</p>
<pre><code>// Tell the phone it scored 100 points
m_netPlayer.SendCmd(&quot;scored&quot;, new MessageScored(100));
</code></pre><p>On the phone a handler must be registered for that command</p>
<pre><code>client.addEventListener(&#39;scored&#39;, function(data) {
  score += data.points;
});
</code></pre><p>Again <strong>It&#39;s up to you to decide what messages your game needs, make a class
to represent that data and write the corresponding JavaScript to receive it.</strong></p>
<h2 id="handling-players-disconnecting">Handling players Disconnecting</h2>
<p>Players will disconnect from the game. Maybe they started talking to someone. Maybe
they got a call and stopped playing. Regardless it&#39;s up to you to deal with it.
This line in your <code>InitializeNetPlayer</code> method says when the player disconnects
call the <code>Remove</code> method.</p>
<pre><code>// Register handler to call if the player disconnects from the game.
m_netPlayer.OnDisconnect += Remove;
</code></pre><p>The sample <code>Remove</code> method looks like this</p>
<pre><code>private void Remove(object sender, EventArgs e) {
    Destroy(gameObject);
}
</code></pre><p>That method immediately destroys the prefab that was originally created.
<strong>It&#39;s up to you to decide what is appropriate for your game to do when
a player disconnects</strong>. For example maybe rather than kill the <code>GameObject</code>
you&#39;d like the let AI take over for that player. Or maybe you&#39;d like to <a href="reusing-players.html">keep
it around and either let the player reconnect or let some other player use it</a>.
It&#39;s really up to you.</p>
<h2 id="happyfuntimes-on-the-phone">HappyFunTimes on the phone</h2>
<p>If you open <code>Assets/WebPlayerTemplates/HappyFunTimes/controllers/simple/controller.html</code> you&#39;ll
see the HTML for a sample controller. You can see it includes 3 scripts</p>
<pre><code>&lt;script src=&quot;/hft/hft.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/sample-ui/sample-ui.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;scripts/controller.js&quot;&gt;&lt;/script&gt;
</code></pre><p><code>hft.js</code> is HappyFunTimes. This script connects the phone to the game. it is the only part 100% required
for HappyFunTimes.</p>
<p>It exposes <code>hft.GameClient</code> which you initialize like this</p>
<pre><code>var client = new hft.GameClient();
</code></pre><p>At at that point you can add handlers and send messages like above.</p>
<p>If you want to display something when the player is disconnected, for example if you stop the game,
you can add a handle</p>
<pre><code>client.addEventListener(&#39;disconnect&#39;, functionToCallWhenDisconnected);
</code></pre><p>The sample-ui, see below, already handles this message but if you&#39;re not using the sample-ui then
this is how you check for being disconnected. Other than displaying a message there&#39;s not much to
do. HappyFunTimes will take care of reconnecting the player if the game restarts.</p>
<h2 id="the-sample-ui">The sample-ui</h2>
<p>All of the sample controllers are based off some code called the &quot;sample-ui&quot;. It&#39;s just that, a sample.
You&#39;re free to use it or not. The sample UI manages orientation, fullscreen, letting the player enter
a name, etc.. It also has functions for reading touch input etc.. Look at any sample to see how it&#39;s
used.</p>
<p>A typical example looks like this. First we pull out all the libraries into local variables</p>
<pre><code>var commonUI = sampleUI.commonUI;
var input = sampleUI.input;
var misc = sampleUI.misc;
var mobileHacks = sampleUI.mobileHacks;
var strings = sampleUI.strings;
var touch = sampleUI.touch;
</code></pre><p>Then after we&#39;ve created the <code>HFT.GameClient</code> (see above) we call a few functions</p>
<pre><code>commonUI.setupStandardControllerUI(client, globals);
commonUI.askForNameOnce();
commonUI.showMenu(true);
</code></pre><p>The first one</p>
<pre><code>commonUI.setupStandardControllerUI(client, globals);
</code></pre><p>Lets the sample-ui look for disconnect and messages related to the player&#39;s name</p>
<p>The second line</p>
<pre><code>commonUI.askForNameOnce();
</code></pre><p>says &quot;if the player hasn&#39;t set their name ask them to enter one&quot;.
If you&#39;re game doesn&#39;t need a player name delete that line.</p>
<p>The last line</p>
<pre><code>commonUI.showMenu(true);
</code></pre><p>says show the gear menu in the top right that lets the player change their name
If you don&#39;t want the menu change this <code>true</code> to <code>false</code>.</p>
<p>Above that in most controllers is this</p>
<pre><code>var globals = {
  debug: false,
  //orientation: &quot;landscape-primary&quot;,
};
misc.applyUrlSettings(globals);
mobileHacks.fixHeightHack();
mobileHacks.disableContextMenu();
</code></pre><p>The first part just declares some global object to hold various settings</p>
<p>This line</p>
<pre><code>misc.applyUrlSettings(globals);
</code></pre><p>parses the query string into globals. In particular a JSON string assigned to settings
so if your controller URL is <code>http://localhost:18679?settings={foo:123,bar:&quot;abc&quot;}</code>
then <code>globals.foo</code> will be <code>123</code> and <code>globals.bar</code> will be <code>&quot;abc&quot;</code>.
You can use this during development to pass in stuff for testing etc.</p>
<p>This line</p>
<pre><code>mobileHacks.fixHeightHack();
</code></pre><p>tries to deal with some quirks of mobile browsers.</p>
<p>The last line</p>
<pre><code>mobileHacks.disableContextMenu();
</code></pre><p>tries to disable the context menu. Otherwise if the player holds their finger on the
phone its browser menu will pop up asking them if they want to copy etc...</p>
<h2 id="docs-for-the-sample-ui">Docs for the sample-ui</h2>
<p><a href="/docs/hft/">The various JavaScript functions of the sample-ui are documented here</a>.</p>
<h2 id="dealing-with-the-player-s-name">Dealing with the player&#39;s name</h2>
<p>One other thing the sample-ui does is let the player enter and edit a name. On the C# side
there is a corresponding class <code>HFTPlayerNameManager</code> that deals with the messages related
to name editing from the sample-ui. To use it create an instance of that class in your
<code>InitializeNetPlayer</code> function. For example</p>
<pre><code>private HFTPlayerNameManager m_playerNameManager;

void InitializeNetPlayer(SpawnInfo spawnInfo) {
    ...
    // Track name changes
    m_playerNameManager = new HFTPlayerNameManager(m_netPlayer);
    m_playerNameManager.OnNameChange += ChangeName;

    ...
}

private void ChangeName(string name) {
    Debug.Log(&quot;new name is: &quot; + name);
}
</code></pre><p>Be sure to cleanup when your <code>GameObject</code> is destroyed.</p>
<pre><code>void OnDestroy() {
    if (m_playerNameManager != null) {
      m_playerNameManager.Close();
      m_playerNameManager = null;
    }
}
</code></pre><h2 id="more">More</h2>
<p>See <a href="self-control.html">Make Controllers</a> for a few more details.</p>


            <div class="docs-footer">

                <div>Found a bug? <a href="http://github.com/greggman/happyfuntimes/issues">Create an issue on Github</a></div>

                <div class="docs-comments">
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        var disqus_shortname = 'happyfuntimes';
                        var disqus_identifier = 'The Basics of HappyFunTimes and Unity';
                        var disqus_title = 'The Basics of HappyFunTimes and Unity';

                        /* * * DON'T EDIT BELOW THIS LINE * * */
                        (function () {
                            if (window.location.hostname.indexOf("happyfuntimes") < 0) {
                                return;
                            }
                            var dsq = document.createElement('script');
                            dsq.type = 'text/javascript';
                            dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments
                        powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">
                        comments powered by <span class="logo-disqus">Disqus</span>
                    </a>
                </div>

            </div>
        </div>

        <div class="col-xs-12 col-lg-4 docs-sidebar">
            <ul class="toc">
    <li>HappyFunTimes & Unity
        <ul>
            <li><a href="getting-started.html">Getting Started</a><span class="hide">: Do this first!</span></li>
            <li><a href="first-game.html">Your First HappyFunTimes Game</a><span class="hide">: Do this second!</span>
            </li>
            <li><a href="gamepad.html">The Sample Gamepad</a><span class="hide">: Read this!</span></li>
            <li><a href="basics.html">How it Works</a><span class="hide">: Read this!</span></li>
        </ul>
    </li>
    <li>Specifics
        <ul>
            <li><a href="player-connect.html">Spawn players</a></li>
            <li><a href="self-control.html">Making controllers (the phone part)</a></li>
            <li><a href="gamepad-sounds.html">Playing sounds on the phone</a></li>
            <li><a href="gamepad-multitouch.html">Handling Multi-Touch</a></li>
        </ul>
    </li>
    <li>Examples
        <ul>
            <li><a href="3d-characters.html">3d Characters</a></li>
            <li><a href="2d-platformer.html">2d Platformer</a></li>
        </ul>
    </li>
    <li>Techinques
        <ul>
            <li><a href="reusing-players.html">Handling disconnect and reconnect</a></li>
            <li><a href="too-many-players.html">Preventing too many players</a></li>
            <li><a href="device-orientation.html">Using Device Orientation</a></li>
            <li><a href="accelerometer.html">Using the Accelerometer</a></li>
            <li><a href="character-selection.html">Spawning different characters per Player</a></li>
            <li><a href="multi-machine.html">Multiple Computers</a></li>
            <li><a href="talking-between-games.html">Talking Between Multiple Computers</a></li>
        </ul>
    </li>
    <li>Sample-UI API Reference
        <ul>
            <li><a href="/docs/hft/">Sample UI (HTML/JavaScript) API</a></li>
        </ul>
    </li>
    <li>Other
        <ul>
            <li><a href="changelog.html">Changelog</a></li>
        </ul>
    </li>
</ul>




        </div>

    </div>
</div>

<script src="/docs/assets/3rdparty/jquery.js"></script>
<script src="/docs/assets/3rdparty/highlight.js"></script>
<script src="/docs/assets/js/lesson.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51764205-4', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>



